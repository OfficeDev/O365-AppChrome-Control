!function(){"use strict";window.Type&&window.Type.registerNamespace?Type.registerNamespace("Office.Controls"):(void 0===window.Office&&(window.Office={},window.Office.namespace=!0),void 0===window.Office.Controls&&(window.Office.Controls={},window.Office.Controls.namespace=!0)),Office.Controls.ImplicitGrantLogin=function(t){this.authContext=new AuthenticationContext(t),this.authContext.handleWindowCallback()},Office.Controls.ImplicitGrantLogin.prototype={authContext:null,aadGraphResourceId:"00000002-0000-0000-c000-000000000000",apiVersion:"api-version=1.5",login:function(t){if(!Office.Controls.Utils.isNullOrUndefined(t)&&!Office.Controls.Utils.isFunction(t))throw new Error("callback is not a function");this.authContext?(Office.Controls.Utils.isNullOrUndefined(t)||(this.authContext.callback=t),this.authContext.login()):console.log("SignIn failed")},logout:function(){this.authContext&&this.authContext.getCachedUser?this.authContext.logOut():console.log("SignOut failed")},getAuthContext:function(){return this.authContext},getAccessTokenAsync:function(t,e){if(!Office.Controls.Utils.isFunction(e))throw new Error("callback is not a function");this.authContext.acquireToken(t,function(t,n){return t||!n?void console.log("ADAL Error Occurred: "+t):void e(t,n)})},getCurrentUser:function(){return this.authContext.getCachedUser()},hasLogin:function(){var t=this.authContext.getCachedUser();return t?!0:!1},getUserImageAsync:function(t,e){var n=this;n.authContext.acquireToken(n.aadGraphResourceId,function(o,i){if(o||!i)return void e("Error",null);var r=n.authContext._extractIdToken(i),a="";r&&r.hasOwnProperty("tid")&&(a=r.tid);var s=new XMLHttpRequest;s.open("GET","https://graph.windows.net/"+a+"/users/"+t+"/thumbnailPhoto?"+n.apiVersion),s.setRequestHeader("Content-Type","application/json"),s.setRequestHeader("Authorization","Bearer "+i),s.responseType="blob",s.onabort=s.onerror=s.ontimeout=function(){e("Error",null)},s.onload=function(){if(401===s.status)return void e("Unauthorized",null);if(200!==s.status)return void e("Unknown error",null);var t=new FileReader;t.addEventListener("loadend",function(){e(null,t.result)}),t.readAsDataURL(s.response)},s.send("")})},getUserInfoAsync:function(t){var e=this.authContext.getCachedUser();if(e){var n=new Object;n.accountName=e.userName,n.displayName=e.profile.given_name+" "+e.profile.family_name,this.getUserImageAsync(e.profile.oid,function(e,o){n.imgSrc=o,t(e,n)})}else t("Not login",null)}}}();